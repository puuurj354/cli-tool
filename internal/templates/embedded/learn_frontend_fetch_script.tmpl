// 1. Basic GET Request with Promises
function fetchUsers() {
    const output = document.getElementById('users-output');
    output.innerHTML = '<p>Loading...</p>';
    
    fetch('https://jsonplaceholder.typicode.com/users')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(users => {
            const userList = users.slice(0, 5).map(user => `
                <div class="user-item">
                    <strong>${user.name}</strong>
                    <p>${user.email}</p>
                </div>
            `).join('');
            
            output.innerHTML = userList;
        })
        .catch(error => {
            output.innerHTML = `<p class="error">Error: ${error.message}</p>`;
        });
}

// 2. Async/Await Pattern
async function fetchPosts() {
    const output = document.getElementById('posts-output');
    output.innerHTML = '<p>Loading...</p>';
    
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts?_limit=5');
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const posts = await response.json();
        
        const postList = posts.map(post => `
            <div class="post-item">
                <h3>${post.title}</h3>
                <p>${post.body}</p>
            </div>
        `).join('');
        
        output.innerHTML = postList;
    } catch (error) {
        output.innerHTML = `<p class="error">Error: ${error.message}</p>`;
    }
}

// 3. POST Request Example
async function createPost() {
    const output = document.getElementById('create-output');
    const title = document.getElementById('post-title').value;
    const body = document.getElementById('post-body').value;
    
    if (!title || !body) {
        output.innerHTML = '<p class="error">Please fill in both fields!</p>';
        return;
    }
    
    output.innerHTML = '<p>Creating post...</p>';
    
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title: title,
                body: body,
                userId: 1
            })
        });
        
        if (!response.ok) {
            throw new Error('Failed to create post');
        }
        
        const data = await response.json();
        
        output.innerHTML = `
            <div class="success">
                <p><strong>Post Created!</strong></p>
                <p>ID: ${data.id}</p>
                <p>Title: ${data.title}</p>
                <p>Body: ${data.body}</p>
            </div>
        `;
        
        // Clear inputs
        document.getElementById('post-title').value = '';
        document.getElementById('post-body').value = '';
    } catch (error) {
        output.innerHTML = `<p class="error">Error: ${error.message}</p>`;
    }
}

// 4. Error Handling Example
async function fetchWithError() {
    const output = document.getElementById('error-output');
    output.innerHTML = '<p>Attempting to fetch invalid URL...</p>';
    
    try {
        const response = await fetch('https://jsonplaceholder.typicode.com/invalid-endpoint');
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        output.innerHTML = `<p>Data: ${JSON.stringify(data)}</p>`;
    } catch (error) {
        output.innerHTML = `
            <div class="error">
                <p><strong>Error Caught!</strong></p>
                <p>${error.message}</p>
                <p>This demonstrates proper error handling with try/catch.</p>
            </div>
        `;
    }
}

// Exercise: Fetch Random User
async function fetchRandomUser() {
    const output = document.getElementById('random-user');
    output.innerHTML = '<p>Loading random user...</p>';
    
    try {
        const response = await fetch('https://randomuser.me/api/');
        
        if (!response.ok) {
            throw new Error('Failed to fetch user');
        }
        
        const data = await response.json();
        const user = data.results[0];
        
        output.innerHTML = `
            <div class="user-profile">
                <img src="${user.picture.large}" alt="${user.name.first}">
                <h3>${user.name.first} ${user.name.last}</h3>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>Location:</strong> ${user.location.city}, ${user.location.country}</p>
                <p><strong>Age:</strong> ${user.dob.age}</p>
            </div>
        `;
    } catch (error) {
        output.innerHTML = `<p class="error">Error: ${error.message}</p>`;
    }
}

// Utility function: Generic API caller
async function apiCall(url, options = {}) {
    try {
        const response = await fetch(url, options);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('API call failed:', error);
        throw error;
    }
}

// Example usage of utility function
async function exampleApiCall() {
    try {
        const users = await apiCall('https://jsonplaceholder.typicode.com/users');
        console.log('Users:', users);
    } catch (error) {
        console.error('Failed to fetch users:', error);
    }
}

console.log('Fetch API examples loaded!');
console.log('Try the buttons above to see different fetch patterns.');
